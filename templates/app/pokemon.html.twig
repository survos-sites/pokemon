{% block pageCongroller 'pokemon' %}
{% extends 'onsPage.html.twig' %}
{% block pageId 'pokemon' %}
{% block toolbar %}
    {{ parent() }}
    <div class="center">home?</div>
{% endblock %}

{% block body %}
    <h3>Pokemon-list</h3>

    {% set stimulusSettings = stimulus_action(_app_sc, 'test', 'click',
        {
            page: 'detail',
            store: 'saved',
            id: '{{ row.id }}'}).toArray %}

    {% set globals = {
        stimulusAction: stimulusSettings['data-action'],
        stimulusParamsVars: stimulusSettings
    } %}

    <twig:dexie
            dbName="pokemon1"
            store="savedTable"
            :globals="globals"
            :filter="{}"
            :caller="_self">

        <twig:block name="twig_template">
            there are {{ rows|length }} rows
        </twig:block>
        <twig:block name="twig_template2" id="hack_to_get_raw_data">
            there are {{ rows|length }} rows

{#            {{ globals.stimulusAction }}#}

{#            {% for row in rows %}#}
{#                #}{#                {{ row|json_encode }} #}
{#                #}{#                <!--{% set checked = row.owned ? 'checked' : '' %}--> #}
{#                <ons-list-item>#}

{#                    <a#}
{#                    {% for var, val in globals.stimulusParamsVars %}#}
{#                        #}{# use the dexie val.  regex row.(.*?) #}
{#                        {% if val == '{{ row.id }}' %}#}
{#                            {% set val = row['id'] %}#}
{#                        {% endif %}#}
{#                        {{ var }}="{{ val }}"#}
{#                    {% endfor %}#}
{#                    >#}
{#                    {{ row.name }} {{ row.id }}#}
{#                    </a>#}

{#                    #}{#                    <a data-action="{{ globals.stimulusAction }}" #}
{#                    #}{#                       {{ globals.stimulusParamsVar }}="{{ row.id }}" > #}
{#                    #}{#                        {{ row.name }} / {{ row.id }} #}
{#                    #}{#                    </a> #}
{#                    <ons-switch#}
{#                            data-controller="ownswitch"#}
{#                            class="right"#}
{#                            data-ownswitch-owned-value="{{ row.owned }}"#}
{#                            data-action="click->app#add"#}
{#                            data-app-id-param="{{ row.id }}">#}
{#                    </ons-switch>#}
{#                </ons-list-item>#}
{#            {% endfor %}#}
{#            #}{# this html tag is used for a regex grab if node->html() doesn't work #}
            <!-- hack_to_get_raw_data -->
        </twig:block>
    </twig:dexie>


    {#    <ons-list {{ stimulus_target(_sc, 'list') }}> #}
    {#        <ons-list-item>TEST</ons-list-item> #}
    {#    </ons-list> #}

    <div {{ stimulus_target('app','spinner') }}
            id="after-list" style="display:none; margin: 20px; text-align: center;">
        <ons-icon icon="fa-spinner" size="26px" spin></ons-icon>
    </div>

{% endblock %}
