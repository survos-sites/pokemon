import { Controller } from '@hotwired/stimulus';
// import db from "../../assets/db.js";
import db from '../db.js'; // this could be generated by inspecting the entity attributes

import Twig from 'twig';

// this has been moved to a generic dexie / twig controller

/*
* The following line makes this controller "lazy": it won't be downloaded until needed
* See https://github.com/symfony/stimulus-bridge#lazy-controllers
*/
/* stimulusFetch: 'lazy' */
export default class extends Controller {
    static targets = ['list']
    static values = {
        twigTemplate: String
    }
    // ...
    connect() {
        super.connect();
        console.log('hi from ' + this.identifier);
        console.log(this.twigTemplateValue)
        document.addEventListener('saved.prechange', ( e => {
            console.log(e);
            console.log('i heard an event! ' + e.type);
        }));

    }

    listTargetConnected()
    {
        console.log('a list target has been connected.');
    }

    displaySavedItems()
    {
        // get the saved items and pass them to the twig template.
        let rows = db.savedTable.filter(n => n.owned).toArray();
        rows.toArray()
            .then( rows => this.template.render({rows: rows}))
            .then( html => this.listTarget.innerHTML = html);
        if (0)
        if (this.hasTwigTemplateTarget) {
            // compile the template
            let template = Twig.twig({
                data: this.twigTemplateTarget.innerHTML
            });
            console.log(template);

            let html = template.render({rows: rows}).then(
                html => this.listTarget.innerHTML = html
            );
            console.log(html);

        }



    }

}
